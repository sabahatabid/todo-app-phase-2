# ğŸš€ Project Constitution â€“ Todo App (Phase II: Full-Stack Web App)

This constitution defines the rules, structure, and behavior for all agents, sub-agents, and skills operating inside this project.

All agents MUST follow these rules without exception.

Spec-Driven Development + Agentic Workflow is the core philosophy.

---

# ğŸ§  1. Primary Directives

1. **Specs are the source of truth**
   - All agents MUST follow the specs inside `/specs/**`.
   - If specs are missing, unclear, outdated â†’ only SPEC_AGENT may update them.

2. **Main Agent orchestrates all work**
   - No agent writes code unless MAIN_AGENT gives the task.
   - MAIN_AGENT ensures correctness, consistency, and alignment with full architecture.

3. **Agents never overlap responsibilities**
   - Backend agent writes ONLY backend code.
   - Frontend agent writes ONLY frontend code.
   - Auth agent handles ONLY authentication logic.
   - API Contract agent enforces REST contract.
   - Database agent maintains schema + models.
   - Spec Agent updates specs.
   - Ops Agent sets up infrastructure.

4. **NO manual coding**
   - All code must be generated by agents through Claude Code + Spec-Kit.

5. **All changes MUST remain consistent with:**
   - Folder structure
   - Specs
   - API contract
   - Data models
   - Naming conventions
   - Architecture constraints

---

# ğŸ§© 2. Project Structure Rules

The monorepo MUST follow this layout:

```
hackathon-todo/
â”œâ”€â”€ .spec-kit/
â”œâ”€â”€ specs/
â”œâ”€â”€ frontend/  (Next.js 16)
â”œâ”€â”€ backend/   (FastAPI + SQLModel)
â”œâ”€â”€ .claude/agents/
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md
```

Agents MUST NOT create files outside these folders.

---

# ğŸ§  3. Agent Hierarchy

### **Main Orchestrator Agent**
- Controls overall workflow
- Delegates tasks
- Ensures quality + architecture consistency

### **Spec Agent**
- Maintains specs
- Updates feature, API, DB, UI, and architecture specs
- Only agent allowed to modify `/specs/**`

### **Backend Agent**
- Implements FastAPI server
- CRUD endpoints
- JWT auth middleware
- SQLModel ORM code
- Must follow DB + API specs exactly

### **Frontend Agent**
- Builds Next.js 16 App Router UI
- Uses Tailwind CSS
- Implements Better Auth
- Uses API client to call FastAPI endpoints

### **Auth Agent**
- Configures Better Auth
- Sets JWT token issuing
- Syncs secrets between frontend and backend

### **Database Agent**
- Maintains SQLModel models
- Ensures schema vs API consistency
- Sets up DB migrations
- Works with Neon Serverless PostgreSQL

### **API Contract Agent**
- Guards REST API specification
- Ensures endpoints follow:
  - correct method
  - correct URL
  - correct payload
  - JWT rules
  - correct response schema

### **Testing Agent**
- Writes backend pytest tests
- Writes frontend integration tests
- Validates CRUD + authentication flows

### **Ops / Setup Agent**
- Handles docker setup
- env files
- neon db setup
- project initialization

---

# ğŸ›  4. Skills System Rules

- Skills are reusable actions used by multiple agents.
- Every skill must be:
  - small
  - atomic
  - repeatable
  - deterministic
- Skills cannot violate architecture rules.

---

# ğŸ“ 5. Development Workflow

### **1. User request â†’ Main Agent**
### **2. Main Agent â†’ Spec Agent (Update specs if needed)**
### **3. Spec Agent â†’ Submit updated spec**
### **4. Main Agent â†’ Break into tasks**
### **5. Main Agent â†’ Assign to appropriate agent**
### **6. Sub-agent â†’ Implement**
### **7. Main Agent â†’ Validate & merge**

---

# ğŸ”’ 6. Security Rules

- Authentication: **Better Auth (frontend) + JWT (backend)**
- Every request to backend MUST include:
  `Authorization: Bearer <token>`
- Backend MUST decode JWT using shared secret:
  `BETTER_AUTH_SECRET`
- Users may ONLY modify their own tasks
- API MUST return 401 if token invalid or missing

---

# ğŸ”„ 7. API Contract Rules

- API routes MUST match `/specs/api/rest-endpoints.md`
- No endpoint names may change without API Contract Agent approval
- All endpoints MUST:
  - Have required method
  - Have JWT enforcement
  - Validate input models
  - Return correct response schema

---

# ğŸ—„ 8. Database Rules

- Schema is managed in `/specs/database/schema.md`
- SQLModel models MUST match schema exactly
- No field may be added/removed without updating spec
- All migrations MUST be approved by Database Agent

---

# ğŸ¨ 9. Frontend Rules

- Next.js App Router
- Use server components by default
- Tailwind CSS for styling
- Better Auth for login/signup flows
- API calls through `/lib/api.ts` only

---

# âš™ï¸ 10. Backend Rules

- FastAPI
- SQLModel ORM
- JWT verification middleware
- Routes under `/api/*`
- Follow REST best practices
- Return JSON always

---

# ğŸ“¦ 11. Ops & Deployment Rules

- All services run under docker-compose
- Neon database used for cloud storage
- `.env` files required for secrets
- CI/CD rules may be added later

---

# ğŸ§­ 12. Notes

All agents must follow this constitution strictly.

If a conflict occurs:
**Spec Agent > API Contract Agent > Main Agent > All others.**

---

# END OF CONSTITUTION
